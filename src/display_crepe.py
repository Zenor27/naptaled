import asyncio
from itertools import cycle

from PIL import Image, ImageDraw

from src.helpers.draw import draw_pattern
from src.napta_matrix import MATRIX_SIZE, RGBMatrix, matrix_script

PATTERN = """
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›ðŸŸ©â¬›â¬›â¬›ðŸŸ¨â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸªâ¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸªâ¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¨â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ©â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ©â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¨â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›
    â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›
    â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›â¬›â¬›ðŸŸ¥â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›ðŸŸ¥â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸªâ¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸªâ¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¨â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ©â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ©â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¨â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›ðŸŸ¦â¬›â¬›â¬›â¬›ðŸŸªâ¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
    â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›
"""

PATTERN_WIDTH = len(PATTERN.splitlines()[1].strip())
PATTERN_HEIGHT = len(PATTERN.splitlines())


@matrix_script
async def display_crepe(matrix: RGBMatrix) -> None:
    RED = (255, 0, 0)
    OFF = (30, 30, 30)
    ON = (0, 0, 255)

    images = [Image.new("RGB", (PATTERN_WIDTH, PATTERN_HEIGHT)) for _ in range(4)]

    draw_pattern(ImageDraw.Draw(images[0]), PATTERN, {"ðŸŸ¥": RED, "ðŸŸ¦": ON, "ðŸŸ©": ON, "ðŸŸ¨": OFF, "ðŸŸª": OFF})
    draw_pattern(ImageDraw.Draw(images[1]), PATTERN, {"ðŸŸ¥": RED, "ðŸŸ¦": OFF, "ðŸŸ©": ON, "ðŸŸ¨": ON, "ðŸŸª": OFF})
    draw_pattern(ImageDraw.Draw(images[2]), PATTERN, {"ðŸŸ¥": RED, "ðŸŸ¦": OFF, "ðŸŸ©": OFF, "ðŸŸ¨": ON, "ðŸŸª": ON})
    draw_pattern(ImageDraw.Draw(images[3]), PATTERN, {"ðŸŸ¥": RED, "ðŸŸ¦": ON, "ðŸŸ©": OFF, "ðŸŸ¨": OFF, "ðŸŸª": ON})

    double_buffer = matrix.CreateFrameCanvas()

    for image in cycle(images):
        double_buffer.SetImage(image, (MATRIX_SIZE - PATTERN_WIDTH) // 2, (MATRIX_SIZE - PATTERN_HEIGHT) // 2)
        double_buffer = matrix.SwapOnVSync(double_buffer)
        await asyncio.sleep(0.1)


if __name__ == "__main__":
    asyncio.run(display_crepe())
